<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.runjian.auth.server.mapper.AppInfoMapper">
    <select id="MySelectPage" resultType="com.runjian.auth.server.domain.vo.system.SysAppInfoVO">
        SELECT sai.id,
               sai.app_name,
               sai.app_ip,
               sai.app_Port,
               sai.app_desc,
               sai.status
        FROM app_info sai
        <where>
            sai.delete_flag = 0
            <if test="appIp != null and appIp != ''">
                <bind name="patternAppIp" value="'%' + appIp + '%'"/>
                AND sai.app_ip LIKE #{patternAppIp}
            </if>
            <if test="appName != null and appName != ''">
                <bind name="patternAppName" value="'%' + appName + '%'"/>
                AND sai.app_name LIKE #{patternAppName}
            </if>
        </where>
    </select>

    <select id="selectAppByRoleCodeList" resultType="com.runjian.auth.server.domain.entity.AppInfo">
        SELECT sai.*
        FROM app_info sai
        LEFT JOIN role_app sra ON sra.app_id = sai.id
        LEFT JOIN role_info sri ON sri.id = sra.role_id
        WHERE sai.delete_flag = 0
        AND sai.status = 0
        AND sri.role_code IN
        <foreach collection="roleList" item="roleCode" open="(" close=")" separator=",">
            #{roleCode}
        </foreach>
    </select>

    <select id="selectAppByRoleCode" resultType="com.runjian.auth.server.domain.entity.AppInfo">
        SELECT sai.*
        FROM app_info sai
            LEFT JOIN role_app sra ON sra.app_id = sai.id
            LEFT JOIN role_info sri ON sri.id = sra.role_id
        WHERE sri.role_code = #{roleCode}
            AND sai.delete_flag = 0
            AND sai.status = 0
    </select>

    <select id="findAppIdListByRoleId" resultType="java.lang.Long">
        SELECT app_id
        FROM role_app
        WHERE role_app.role_id = #{roleId,jdbcType=BIGINT}
    </select>
</mapper>
